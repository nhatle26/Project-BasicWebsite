<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch sử đơn hàng - Cửa hàng hoa</title>
    <link rel="stylesheet" href="../style/style.css">
   
</head>
<body>
    <!-- HEADER -->
    <header>
        <nav>
            <a href="home.html" class="logo">🌹 Flower Shop</a>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Tìm hoa, chậu, phụ kiện...">
                <button onclick="searchProducts()">🔍</button>
            </div>
            <div class="nav-menu">
                <a href="home.html">Trang chủ</a>
                <a href="search.html">Tìm kiếm</a>
                <a href="cart.html" class="cart-icon">
                    🛒 Giỏ hàng
                    <span class="cart-badge" id="cartBadge" style="display: none;">0</span>
                </a>
                <a href="orders.html">📦 Đơn hàng</a>
                <a href="login.html" id="loginLink">Đăng nhập</a>
            </div>
        </nav>
    </header>

    <!-- MAIN CONTENT -->
    <div class="container">
        <h1>📦 Lịch sử đơn hàng</h1>
        
        <div class="orders-container">
            <div id="ordersContent">
                <!-- Đơn hàng sẽ được render ở đây -->
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>🌹 Flower Shop</h3>
                <p>Cửa hàng hoa tươi uy tín, chất lượng cao.</p>
                <p>Giao hàng nhanh chóng, giá cả hợp lý.</p>
            </div>
            <div class="footer-section">
                <h3>Liên hệ</h3>
                <p>📍 123 Nguyễn Huệ, Q.1, TP.HCM</p>
                <p>📞 0901 234 567</p>
                <p>✉️ contact@flowershop.vn</p>
            </div>
            <div class="footer-section">
                <h3>Chính sách</h3>
                <p><a href="#">Chính sách đổi trả</a></p>
                <p><a href="#">Chính sách bảo mật</a></p>
                <p><a href="#">Điều khoản sử dụng</a></p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2024 Flower Shop. All rights reserved.</p>
        </div>
    </footer>

    <!-- IMPORT JS -->
    <script src="../js/cart.js"></script>
    <script src="../js/checkout.js"></script>
    <script src="../js/main.js"></script>
    <script>
        // Render danh sách đơn hàng
        function renderOrders() {
            const ordersContent = document.getElementById('ordersContent');
            const currentUser = window.mainUtils.getCurrentUser();

            if (!currentUser) {
                ordersContent.innerHTML = `
                    <div class="empty-orders">
                        <div style="font-size: 80px; margin-bottom: 20px;">🔒</div>
                        <p style="font-size: 18px; margin-bottom: 20px;">Bạn cần đăng nhập để xem đơn hàng</p>
                        <a href="login.html" class="btn btn-primary" style="display: inline-block; text-decoration: none;">Đăng nhập ngay</a>
                    </div>
                `;
                return;
            }

            const orders = window.checkoutUtils.getUserOrders(currentUser.email);

            if (orders.length === 0) {
                ordersContent.innerHTML = `
                    <div class="empty-orders">
                        <div style="font-size: 80px; margin-bottom: 20px;">📦</div>
                        <p style="font-size: 18px; margin-bottom: 20px;">Bạn chưa có đơn hàng nào</p>
                        <a href="index.html" class="btn btn-primary" style="display: inline-block; text-decoration: none;">Bắt đầu mua sắm</a>
                    </div>
                `;
                return;
            }

            // Sắp xếp đơn hàng mới nhất lên đầu
            orders.sort((a, b) => b.id - a.id);

            ordersContent.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <div class="order-id">Đơn hàng #${order.id}</div>
                            <div style="color: #666; font-size: 12px; margin-top: 5px;">
                                ${new Date(order.createdAt).toLocaleString('vi-VN')}
                            </div>
                        </div>
                        <span class="order-status status-${order.status}">
                            ${window.checkoutUtils.getOrderStatusLabel(order.status)}
                        </span>
                    </div>

                    <div class="order-items">
                        <div style="font-weight: bold; margin-bottom: 10px;">Sản phẩm:</div>
                        ${order.items.map(item => `
                            <div class="order-item">
                                <span>${item.emoji} ${item.name} x${item.quantity}</span>
                                <span>${(item.price * item.quantity).toLocaleString('vi-VN')}đ</span>
                            </div>
                        `).join('')}
                    </div>

                    <div style="font-size: 14px; color: #666; margin-bottom: 10px;">
                        <div><strong>Người nhận:</strong> ${order.fullName}</div>
                        <div><strong>Điện thoại:</strong> ${order.phone}</div>
                        <div><strong>Địa chỉ:</strong> ${order.address}, ${order.district}, ${order.city}</div>
                        <div><strong>Thanh toán:</strong> ${window.checkoutUtils.getPaymentMethodLabel(order.paymentMethod)}</div>
                    </div>

                    <div class="order-footer">
                        <div class="order-total">
                            Tổng cộng: ${order.total.toLocaleString('vi-VN')}đ
                        </div>
                        <div>
                            <button class="btn btn-secondary btn-small" onclick="viewOrderDetail(${order.id})">Chi tiết</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Xem chi tiết đơn hàng
        function viewOrderDetail(orderId) {
            const order = window.checkoutUtils.getOrderById(orderId);
            if (!order) return;

            alert(`Chi tiết đơn hàng #${orderId}\n\n` +
                `Trạng thái: ${window.checkoutUtils.getOrderStatusLabel(order.status)}\n` +
                `Ngày đặt: ${new Date(order.createdAt).toLocaleString('vi-VN')}\n` +
                `Tổng tiền: ${order.total.toLocaleString('vi-VN')}đ`);
        }

        // Tìm kiếm sản phẩm
        function searchProducts() {
            const query = document.getElementById('searchInput').value;
            if (query.trim()) {
                window.location.href = `search.html?q=${encodeURIComponent(query)}`;
            }
        }

        // Load trang
        document.addEventListener('DOMContentLoaded', function() {
            window.mainUtils.updateNavbar();
            window.mainUtils.updateCartBadge();
            renderOrders();
        });

        // Xử lý Enter trong search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchProducts();
        });
    </script>
</body>
</html>